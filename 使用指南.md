# MCP服务统一集成方案

## 概述

这个项目提供了一种稳定可靠的方式来集成三个MCP服务：
1. Weather MCP - 获取天气信息
2. Everart Forge MCP - 生成艺术图片
3. Stable Diffusion MCP - 处理图片

通过使用统一的HTTP API服务器作为中间层，我们解决了直接在前端集成多个MCP服务时可能遇到的问题。

## 架构设计

该解决方案采用了以下架构：

```
前端 (HTML/CSS/JS) <---> 统一API服务器 (Node.js) <---> MCP服务
```

### 主要组件

1. **统一API服务器** (`mcp_unified_server.js`)
   - 提供REST API接口，处理前端请求
   - 负责与各个MCP服务通信
   - 处理错误和异常情况
   - 提供统一的响应格式

2. **统一客户端** (`mcp_unified_client.html`)
   - 提供用户友好的界面
   - 通过API与统一服务器通信
   - 展示处理结果和状态

## 为什么这种方案更稳定

1. **解耦前端和MCP服务**
   - 前端不需要直接了解MCP服务的实现细节
   - 可以独立更新前端和后端

2. **统一错误处理**
   - 所有错误都在服务器端处理和格式化
   - 提供一致的错误响应格式

3. **简化通信模型**
   - 使用标准的HTTP请求/响应模式
   - 不依赖于复杂的消息传递机制

4. **可扩展性**
   - 轻松添加新的MCP服务
   - 可以添加缓存、日志和监控功能

## 如何使用

### 启动服务器

```bash
node mcp_unified_server.js
```

服务器将在 http://localhost:3001 上运行。

### 访问客户端

在浏览器中打开 http://localhost:3001 即可访问统一客户端界面。

### 使用流程

1. 输入城市名称，点击"获取天气"按钮获取天气信息
2. 系统会根据天气信息自动生成图片提示词
3. 点击"生成图片"按钮，使用Everart Forge生成天气相关的图片
4. 系统会根据天气信息自动生成Stable Diffusion提示词
5. 点击"处理图片"按钮，使用Stable Diffusion处理图片

## 技术细节

### 服务器实现

统一API服务器使用Node.js的原生HTTP模块实现，主要功能包括：

- 处理静态文件请求
- 提供REST API接口
- 与MCP服务通信
- 错误处理和日志记录

### 客户端实现

统一客户端使用纯HTML/CSS/JavaScript实现，主要功能包括：

- 用户友好的界面
- 步骤引导和状态显示
- 异步API请求
- 结果展示和错误处理

## 扩展和定制

### 添加新的MCP服务

要添加新的MCP服务，只需在`mcp_unified_server.js`中：

1. 创建新的处理函数
2. 在API请求处理中添加对应的条件判断
3. 实现与新MCP服务的通信逻辑

### 自定义界面

可以根据需要修改`mcp_unified_client.html`文件来自定义界面样式和行为。

## 故障排除

### 常见问题

1. **服务器无法启动**
   - 检查端口3001是否被占用
   - 确保Node.js已正确安装

2. **无法获取天气信息**
   - 检查OpenWeather API密钥是否有效
   - 确保输入的城市名称正确

3. **图片生成失败**
   - 检查Everart Forge MCP服务是否正常运行
   - 查看服务器日志获取详细错误信息

4. **图片处理失败**
   - 检查Stable Diffusion MCP服务是否正常运行
   - 查看服务器日志获取详细错误信息
